<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="robots" content="noodp,index,follow">
    <meta name="revisit-after" content="1 days">
    <meta name="google-site-verification" content="ZFrkEu3QMFl9Kz0JyK2SfzdIZ84lDgm9gLQ6J6FmAvg">
    <meta name="p:domain_verify" content="faa7b25edce176988fb8171e9457554a">

    <!-- Facebook Webmasters -->
    <meta property="og:url" content="https://vhnam.github.io/blog/nhap-mon-deploy-ung-dung-viet-bang-react">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Nhập môn deploy ứng dụng viết bằng React">
    <meta property="og:description" content="Bài viết mang tính chất cay cú React.js. Ghi lại kinh nghiệm đau thương của tác giả khi deploy.">
    <meta property="og:image" content="https://vhnam.github.io/blog/nhap-mon-deploy-ung-dung-viet-bang-react/img/thumbnails.jpg">
    <meta property="og:locale" content="vi_VN">
    <meta property="fb:app_id" content="2064203853819553">

    <title>Nhập môn deploy ứng dụng viết bằng React | Nam Vo</title>

    <link rel="shortcut icon" href="/src/assets/favicon.ico" type="image/x-icon">
    <link rel="canonical" href="http://vhnam.github.io/">
    <link rel="publisher" href="https://plus.google.com/116570296349523695729">

    <link rel="stylesheet" href="/src/assets/css//bootstrap.css">
    <link rel="stylesheet" href="/src/assets/css//theme.css">
    <link rel="stylesheet" href="/src/assets/css//pages/post.css">

    <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body itemscope="itemscope" itemtype="https://schema.org/BlogPosting">
    <nav class="navbar navbar-expand-lg navbar-light bg-jungle-mist shadow">
        <div class="container">
            <a class="navbar-brand text-river-bed font-weight-light" href="/">Nam Vo</a>
            <button class="navbar-toggler" type="button" 
                    data-toggle="collapse" data-target="#navbarNavDropdown" 
                    aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/blog">Nhật ký</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tutorials">Chuyện ngành</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Portfolio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about.html">Thông tin</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/contact.html">Liên lạc</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="content">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="content__heading">
                        <h1 class="content__title" itemprop="headline">Nhập môn deploy ứng dụng viết bằng React</h1>
                        <p class="content__time">Ngày 7 tháng 10 năm 2018</p>
                        <meta itemprop="author" content="Nam Vo">
                        <meta itemprop="datePublished" content="2018-10-07">
                        <meta itemprop="dateModified" content="2018-10-07">
                        <meta itemprop="mainEntityOfPage" content="Bài viết mang tính chất cay cú React.js. Ghi lại kinh nghiệm đau thương của tác giả khi deploy.">
                    </div>
                    
                    <p>
    Công việc đầu tiên khi vào công ty mới là làm một ứng dụng với React. Công việc tiếp theo là làm lại blog với React. Và thế là hành ngập mặt bắt đầu từ đây.
</p>
<img alt="React" itemprop="image" src="img/thumbnails.jpg"/>
<span class="heading" id="deploy-trn-aws-s3"></span><h2 itemprop="headline">Deploy trên AWS S3</h2>
<p>
    Vì đặc thù công việc, nên mình phải tìm một nơi để chạy demo cho các sếp review. Công ty mình dùng Amazon Web Services (AWS). Công việc chỉ là deploy một static web được tạo bằng <strong>create-react-app</strong>, do đó cũng nghĩ là đẩy source code lên là được.
</p>
<p>
    Ứng dụng này là một single page app, nên mình gõ đường dẫn <code>http://demo.aws.amazon.com</code> là vô được. Sau đó thử một đường dẫn khác là <code>http://demo.aws.amazon.com/another-page</code> vẫn chạy ngon lành.
</p>
<img alt="Homepage" itemprop="image" src="img/part-1__step-1.jpg"/>
<p>
    Bây giờ, mình nhấn vào một link bất kỳ, em ấy vẫn load được giao diện. Các bạn để ý chỗ mình khoanh đỏ nhé.
</p>
<img alt="Approval" itemprop="image" src="img/part-1__step-2.jpg"/>
<p>
    Câu chuyện bắt đầu từ đây khi mình nhấn <strong>Enter</strong>, truy cập trực tiếp vào địa chỉ trên.
</p>
<img alt="404 Not Found" itemprop="image" src="img/part-1__step-3.jpg"/>
<p>
    Ngạc nhiên chưa? Thực tế, đường dẫn này nó phải có dạng <code>http://demo.aws.amazon.com/#/another-page</code>. Tức là phải có kí tự <code>#</code>. Ở đây, đường dẫn chỉ là JavaScript load nội dung lên và overwrite lại đường dẫn để chúng ta thấy chỉ còn <code>http://demo.aws.amazon.com/another-page</code>. Rõ ràng hơn, bạn vào trực tiếp một địa chỉ không hề tồn tại.
</p>
<p>
    Cảm ơn anh <a href="https://www.linkedin.com/in/vunguyentuan/" itemprop="url">Vũ Nguyễn</a> đã hướng dẫn là phải cấu hình Error trên con S3. Cụ thể như sau.
</p>
<img alt="AWS - S3" itemprop="image" src="img/aws-s3.jpg"/>
<p>
    Như đã nói ở trên, do vào trực tiếp thì không tồn tại đường dẫn trên. Chỉnh lại Error để mỗi khi xuất hiện lỗi, tự động quay về trang chủ. Và về được trang chủ, code JavaScript sẽ tự động xử lý URL và load đúng màn hình.
</p>
<span class="heading" id="m-nh-mang-tn-service-worker"></span><h2 itemprop="headline">Ám ảnh mang tên Service Worker</h2>
<p>
    Rất tiếc, chủ đề này mình không có chụp lại ảnh minh hoạ. Mình sẽ cố giải thích rõ ràng. Trước hết, các bạn có thể tham khảo các bài viết dưới đây để tìm hiểu về Service Worker.
</p>
<ul>
<li><a href="https://support.google.com/partners/answer/7336697?hl=en" itemprop="url">Introduction to Service Worker</a></li>
<li><a href="https://kipalog.com/posts/JAVASCRIPT-SERVICE-WORKER-CO-BAN" itemprop="url">JavaScript Service Worker cơ bản</a></li>
<li><a href="https://viblo.asia/p/gioi-thieu-ve-service-worker-Qbq5QLgXlD8" itemprop="url">Giới thiệu về Service Worker</a></li>
</ul>
<p>
    Tóm gọn, Service Worker dùng để hỗ trợ bạn truy cập vào trang web, kể cả khi nó offline aka đọc nội dung từ Cache. Và nó cache khá kinh dị.
</p>
<p>
    Và React liên quan gì đến thằng này? Số là khi bạn tạo React App bằng <code>create-react-app</code> thì nó đính kèm sẵn một file <code>registerServiceWorker.js</code>. Khi bạn cho nó chạy ở chế độ <code>production</code> là nó kích hoạt lên. Nếu client chạy file này là nó sẽ cache, không thể update được phiên bản mới nhất của website. Tin tui đi, hổng lừa mấy bạn đâu. Muốn xoá thì phải chỉnh lại Service Worker của trình duyệt và client bình thường hổng có biết vụ này.
</p>
<pre>
my-app
├── README.md
├── node_modules
├── package.json
├── .gitignore
├── public
│   ├── favicon.ico
│   ├── index.html
│   └── manifest.json
└── src
    ├── App.css
    ├── App.js
    ├── App.test.js
    ├── index.css
    ├── index.js
    ├── logo.svg
    └── registerServiceWorker.js
</pre>
<p>
    Nói chung cũng cảm ơn anh Prodduct Owner trời đánh thánh đâm, mỗi lần gặp anh là bị sạt nhưng cũng học được từ anh.
</p>
<blockquote>
    also i notice that u are using serviceworker, for now its fine, when the workflow kick in, potentially need to do more work on it especially since its meant for offline caching, lots of potential security loopholes can be found there making it not OWASP compliant especially if it caches sensitive form information
</blockquote>
<span class="heading" id="cht-h"></span><h2 itemprop="headline">Chốt hạ</h2>
<p>
    Có mỗi 2 cái này là mình cay cú khi làm việc với React. Để từ từ xem có gì hay ho sẽ viết tiếp.
</p>

                </div>
                <div class="col-lg-4 pl-5">
                    <ul class="content__index index" id="index">
                        <ul><li><a id="prefix-deploy-trn-aws-s3" href="#deploy-trn-aws-s3" class="index__item index--highlight">Deploy trên AWS S3</a></li><li><a id="prefix-m-nh-mang-tn-service-worker" href="#m-nh-mang-tn-service-worker" class="index__item">Ám ảnh mang tên Service Worker</a></li><li><a id="prefix-cht-h" href="#cht-h" class="index__item">Chốt hạ</a></li></ul>
                    </ul>
                </div>
            </div>

            <div class="content__footer">
                <div class="social-plugin">
                    <div class="like-share">
                        <!-- Facebook -->
                        <div class="fb-like" data-href="http://vhnam.github.io/blog/nhap-mon-deploy-ung-dung-viet-bang-react" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>

                        <div class="mt-3">
                            <!-- Twitter -->
                            <a href="https://twitter.com/share" class="twitter-share-button"{count} data-url="http://vhnam.github.io/blog/nhap-mon-deploy-ung-dung-viet-bang-react" data-via="vhnam2504">Tweet</a>

                            <!-- Google Plus -->
                            <div class="g-plusone" data-annotation="inline" data-width="300"></div>
                        </div>
                    </div>
                    <div class="comments">
                        <div class="fb-comments" data-href="http://vhnam.github.io/blog/nhap-mon-deploy-ung-dung-viet-bang-react" data-numposts="10"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container d-flex justify-content-between">
            <ul class="nav">
                <li class="nav-item">
                    <a class="nav-link text-white" href="#">Điều khoản bảo mật</a>
                </li>
            </ul>
            <div class="d-flex align-items-center text-white">
                &copy; <span class="mx-1" id="footer-year"></span> Nam Vo's blog
            </div>
        </div>
    </footer>

    <script src="/src/assets/js/dist/bundle.js"></script>
    <script src="/src/assets/js/post.js"></script>

    <script>
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <script>
        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script>

    <script>
        !function(d,s,id){
            var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';
            if(!d.getElementById(id)){js=d.createElement(s);
                js.id=id;js.src=p+'://platform.twitter.com/widgets.js';
                fjs.parentNode.insertBefore(js,fjs);
            }
        }(document, 'script', 'twitter-wjs');
    </script>

    <!-- Facebook Analytics -->
    <script>
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '2064203853819553',
                xfbml      : true,
                version    : 'v3.0'
            });
            
            FB.AppEvents.logPageView();   
        };

        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-66016963-1', 'auto');
        ga('require', 'linkid', 'linkid.js');
        ga('require', 'displayfeatures');
        ga('send', 'pageview');
    </script>
</body>
</html>
