<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="noodp,index,follow">
    <meta name="revisit-after" content="1 days">
    <meta name="google-site-verification" content="ZFrkEu3QMFl9Kz0JyK2SfzdIZ84lDgm9gLQ6J6FmAvg">
    <meta name="p:domain_verify" content="faa7b25edce176988fb8171e9457554a">

    <!-- Facebook Webmasters -->
    <meta property="og:url" content="https://vhnam.github.io/blog/javascript-debounce-function-la-gi">
    <meta property="og:type" content="article">
    <meta property="og:title" content="JavaScript - Debounce Function là gì?">
    <meta property="og:description" content="Việc xử lý sự kiện gởi dữ liệu với một tần suất nhanh ở các khung search, đôi khi sẽ sai lệch thông tin và ảnh hưởng tới UX. Để giải quyết bài toán này, ta có thể tham khảo kỹ thuật Debounce.">
    <meta property="og:image" content="https://vhnam.github.io/blog/javascript-debounce-function-la-gi/img/thumbnails.jpg">
    <meta property="og:locale" content="vi_VN">
    <meta property="fb:app_id" content="2064203853819553">

    <title>JavaScript - Debounce Function là gì? | Nam Vo</title>

    <link rel="shortcut icon" href="/public/favicon.ico" type="image/x-icon">
    <link rel="canonical" href="http://vhnam.github.io/">
    <link rel="publisher" href="https://plus.google.com/116570296349523695729">

    <link rel="stylesheet" href="/public/css/bootstrap.css">
    <link rel="stylesheet" href="/public/css/post.css">

    <link rel="stylesheet" href="css/style.css">

    <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body itemscope="itemscope" itemtype="https://schema.org/BlogPosting">
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="/" itemprop="url">
                <img src="/public/img/favicon.png" alt="Nam Vo" height="48" width="48">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex" itemscope="itemscope" itemtype="https://schema.org/SiteNavigationElement">
                    <li class="nav-item">
                        <a class="nav-link" itemprop="url" href="/">Trang chủ</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" itemprop="url" href="/blog">Nhật Ký</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" itemprop="url" href="/tutorials">Chuyện Lập Trình</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" itemprop="url" href="/about.html">Giới Thiệu</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" itemprop="url" href="/contact.html">Liên Hệ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="hero">
        <div class="container">
            <div class="row">
                <div class="col"></div>
                <div class="col-md-8">
                    <h1 class="hero__title" itemprop="headline">JavaScript - Debounce Function là gì?</h1>
                    <h2 class="hero__subtitle">Ngày 3 tháng 11 năm 2015</h2>
                    <meta itemprop="author" content="Nam Vo">
                    <meta itemprop="datePublished" content="2015-11-03">
                    <meta itemprop="dateModified" content="2015-11-03">
                    <meta itemprop="mainEntityOfPage" content="Việc xử lý sự kiện gởi dữ liệu với một tần suất nhanh ở các khung search, đôi khi sẽ sai lệch thông tin và ảnh hưởng tới UX. Để giải quyết bài toán này, ta có thể tham khảo kỹ thuật Debounce.">
                </div>
                <div class="col"></div>
            </div>
        </div>
        <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
            <meta itemprop="name" content="GitHub">
            <span hidden itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
                <img itemprop="url" src="/public/img/github.png" alt="GitHub">
                <meta itemprop="width" content="48">
                <meta itemprop="height" content="48">
             </span>
        </div>
    </section>

    <section class="content">
        <div class="container">
            <h2 hidden>Nội dung</h2>
            <div class="row">
                <div class="col"></div>
                <div class="col-md-8">
                    <div class="content__body">
                        <p>
    Trong một bài test của mình, có một câu là hãy thực hiện <a itemprop="url" href="https://en.wikipedia.org/wiki/Google_Search#Instant_Search">Instant Search</a> giống của <a itemprop="url" href="https://twitter.com/search-home">Twitter</a>. Cách sử dụng là khi bạn nhập một ký tự thì sẽ gởi một request lên Server để lấy dữ liệu.
</p>
<img src="img/global-search.gif" alt="Instant Search" />

<h3>Vấn đề đặt ra</h3>
<script src="https://gist.github.com/vhnam/5074780573f99a29ee87.js"></script>
<p>
    Bạn viết đoạn code như trên. Khi bạn nhập <strong>"abc"</strong> thì sẽ có 3 request được gởi đi lần lượt cho <strong>"a"</strong>, <strong>"ab"</strong> và <strong>"abc"</strong>. Giả sử, thứ tự dữ liệu được trả về lần lượt là <strong>"a"</strong>, <strong>"abc"</strong> và <strong>"ab"</strong>. Có gì đó sai sai ở đây?
</p>
<img src="img/example.png" alt="Example" />

<p>
    Trong khi đó, kết quả bạn cần là <strong>"abc"</strong> chứ không phải là <strong>"ab"</strong>. Như vậy, lỗi này sẽ ảnh hưởng tới <a itemprop="url" href="https://en.wikipedia.org/wiki/User_experience">UX (User Experience)</a>. Để giải quyết vấn đề đó sẽ có rất nhiều cách. Mình tin là có bác sẽ nghĩ tới chuyện chờ người dùng nhập xong khoảng độ 1 giây, rồi lấy kết quả cuối cùng đem đi gởi. Vậy làm sao để biết nó khi nào nhập xong ta? Lúc đó thì ta sẽ sử dụng một kỹ thuật có tên là <strong>Debounce</strong>.
</p>
<img src="img/debounce.png" alt="debounce()" />

<h3>Demo</h3>
<p>
    Ở demo này, mình sẽ sử dụng một hàm <code>getRandomNumber()</code> để phát sinh thời gian delay để giả lập việc gởi request đến server có độ trễ (delay). Do đó, với ví dụ không sử dụng hàm <code>debounce()</code> thì sẽ chờ một khoảng thời gian mới hiện kết quả. TƯơng tự với ví dụ có sử dụng hàm <code>debounce()</code>, nhưng nó sẽ hiện thị kết quả khác.
</p>
<div class="demo-block">
    <h4>Không có sử dụng hàm <code>debounce</code></h4>
    <input type="text" id="input-without-debounce" placeholder="Write something..." />
    <div id="clear-without-debounce" class="btn-clear">CLEAR</div>
    <div id="result-without-debounce" class="demo-results"></div>
</div>
<div class="demo-block">
    <h4>Có sử dụng hàm <code>debounce</code></h4>
    <input type="text" id="input-with-debounce" placeholder="Write something..." />
    <div id="clear-with-debounce" class="btn-clear">CLEAR</div>
    <div id="result-with-debounce" class="demo-results"></div>
</div>

<h3>Debounce Function</h3>
<p>
    Đầu tiên, bạn sẽ muốn gọi hàm <code>debounce(func, wait)</code>, truyền vào hàm cần thực thi và thời gian delay. Do đó, bạn sẽ viết hàm <code>debounce</code> sẽ trả về một hàm anonymous.
</p>
<script src="https://gist.github.com/vhnam/8585a258da7b8a048b6d.js"></script>

<p>
    Sau đó, bạn sẽ cần lấy giá trị của các tham số truyền vào.
</p>
<script src="https://gist.github.com/vhnam/3359aed87b9353517e91.js"></script>

<p>
    Tiếp theo là bạn tạo một hàm tên là <code>executeFunction</code> để khi gọi hàm này, thì hàm được truyền vào sẽ thực thi.
</p>
<script src="https://gist.github.com/vhnam/df5f2f80761a0ca98858.js"></script>

<p>
    Bây giờ, ta gọi hàm <code>setTimeout</code> để delay việc thực thi mỗi khi gọi hàm <code>debounce</code> tương ứng với <code>wait</code> giây.
</p>
<script src="https://gist.github.com/vhnam/e2a2974085c7a977869b.js"></script>

<p>
    Quay lại với giải pháp đã đưa ra, đoạn code tới đây đã giải quyết được vấn đề mỗi khi người dùng nhập thì delay một khoảng thời gian mới thực thi hàm. Nhưng có gì đó sai sai! Hình như là nó chưa lấy được giá trị cuối cùng của người dùng sau khi nhập rồi mới gởi request. Ta chỉ cần xóa đi các lần gọi hàm trước đó là được chứ gì, dùng hàm <code>clearTimeout</code>.
</p>
<script src="https://gist.github.com/vhnam/283853bc456ad9cd34d1.js"></script>

<p>
    Như vậy là đã viết xong hàm <code>debounce</code>. Để sử dụng thì ta viết như sau.
</p>
<script src="https://gist.github.com/vhnam/1e819412dedd1fa3209d.js"></script>

<h3>Chuyện bên lề</h3>
<p>
    Trên blog của <a itemprop="url" href="https://yinyangit.wordpress.com/2015/06/24/javascript-gioi-thieu-ve-debounce-function/">YinYangIT</a> có đề cập tới một chiêu thức khác đó là <a itemprop="url" href="https://yinyangit.wordpress.com/2012/03/15/javascript-tao-chuyen-dong-voi-windowanimationtiming-api/">requestAnimationFrame()</a> thay thế cho <code>setTimeout()</code>. Bạn thậm chí có thể không cần đến tham số <strong>wait</strong> khi sử dụng phương pháp này. Nếu bạn nào có thời gian nghiên cứu thì tìm hiểu thêm.
</p>
<p>
    Hàm <code>debounce</code> đã được một số thư viện hỗ trợ như là <a itemprop="url" href="http://underscorejs.org/#debounce">Underscore.js</a>, <a itemprop="url" href="https://lodash.com/docs#debounce">Lodash</a>. Thực ra, đoạn code được dùng demo là của Underscore phiên bản cũ. Cá nhân thì thấy nếu bạn có nhu cầu tìm hiểu các kỹ thuật khi làm việc với JavaScript, nên đọc mã nguồn của <a itemprop="url" href="https://github.com/jashkenas/underscore">Underscore.js</a> và nên đọc toàn bộ mã nguồn đã release để hiểu được rõ ràng vấn đề hơn.
</p>

<h3>Tham khảo</h3>
<ul class="reference">
    <li>
        <a itemprop="url" href="https://yinyangit.wordpress.com/2015/06/24/javascript-gioi-thieu-ve-debounce-function/">Javascript – Giới thiệu về Debounce Function</a>
    </li>
    <li>
        <a itemprop="url" href="http://drupalmotion.com/article/debounce-and-throttle-visual-explanation">Debounce and Throttle: a visual explanation</a>
    </li>
</ul>
                    </div>

                    <div class="content__footer">
                        <div class="social-plugin">
                            <div class="like-share">
                                <!-- Facebook -->
                                <div class="fb-like" data-href="http://vhnam.github.io/blog/not-quite-my-tempo" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>
    
                                <div>
                                    <!-- Twitter -->
                                    <a href="https://twitter.com/share" class="twitter-share-button"{count} data-url="http://vhnam.github.io/blog/not-quite-my-tempo" data-via="vhnam2504">Tweet</a>
    
                                    <!-- Google Plus -->
                                    <div class="g-plusone" data-annotation="inline" data-width="300"></div>
                                </div>
                            </div>
                            <div class="comments">
                                <div class="fb-comments" data-href="http://vhnam.github.io/blog/not-quite-my-tempo" data-numposts="10"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col"></div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-left">
                    He who loves practice without theory is like the sailor who boards [a] ship without a rudder and compass and never knows where he may cast. — Leonardo da Vinci
                </div>
                <div class="col-md-6 text-right">
                    Copyright &copy; 2018 Nam Vo
                </div>
            </div>
        </div>
    </footer>

    <script src="/public/js/bootstrap.js"></script>

    <script src="js/script.js"></script>

    <script>
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <script>
        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script>

    <script>
        !function(d,s,id){
            var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';
            if(!d.getElementById(id)){js=d.createElement(s);
                js.id=id;js.src=p+'://platform.twitter.com/widgets.js';
                fjs.parentNode.insertBefore(js,fjs);
            }
        }(document, 'script', 'twitter-wjs');
    </script>

    <!-- Facebook Analytics -->
    <script>
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '2064203853819553',
                cookie     : true,
                xfbml      : true,
                version    : '3.0'
            });
            
            FB.AppEvents.logPageView();   
        };

        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-66016963-1', 'auto');
        ga('send', 'pageview');
    </script>
</body>
</html>
