<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="description" content="Software Engineering">
		<title>Kết nối MySQL bằng Servlet - JSP với NetBean (phần 2)</title>
		<link href="/public/img/favicon.png" rel="shortcut icon">
		<link rel="stylesheet" href="/public/css/bootstrap.css">
		<link rel="stylesheet" href="/public/css/bootstrap-theme.css">
		<link rel="stylesheet" href="/public/css/style.css">
		<link href="http://fonts.googleapis.com/css?family=Open+Sans&amp;subset=latin,vietnamese" rel="stylesheet" type="text/css">
	</head>
	<body>
		<div>
			<header>
				<img class="header-logo" src="/public/img/logo.png" alt="Logo">
				<h1 class="header-brand" title="Công nghệ phần mềm">
					<a href="/">Software Engineering</a>
				</h1>
				<nav>
					<ul class="nav header-index">
						<li>
							<a href="/">Blog</a>
						</li>
						<li>
							<a href="/index">Index</a>
						</li>
						<li>
							<a href="/about">About</a>
						</li>
					</ul>
				</nav>
				<nav class="nav-contact">
					<div>
						<a href="https://github.com/vhnam">
							<img title="Github" src="/public/img/github.png" alt="Github">
						</a>
						<a href="https://www.linkedin.com/in/namvh">
							<img title="LinkedIn" src="/public/img/linkedin.png" alt="LinkedIn">
						</a>
					</div>
				</nav>
			</header>
			<section class="content">
				<h2 class="post-title">Kết nối MySQL bằng Servlet - JSP với NetBean (phần 2)</h2>
				<div class="post-content">
					<p>
						Tiếp theo phần 1, phần này chủ yếu sẽ dùng Servlet và JSP để làm một demo.
					</p>
					<article>
						<h3>Servlet - JSP</h3>
						<p>
							Ngoài JSP là công nghệ tạo trang web động bằng Java chúng ta còn có Servlet. Nhưng khi viết bằng JSP thì code Java và các tag HTML trộn lẫn với nhau. Vì vậy, khi chương trình mở rộng thì chúng ta rất khó quản lý các đoạn code này, hơn nữa code JSP để bị người khác đọc vì nó nhúm chung với HTML -> kém bảo mật.
						</p>
						<p>
							Ngược lại khi viết bằng Servlet thì khác, mọi vấn đề trên sẽ được giải quyết một cách đễ dàng. Vậy Servlet là gì ?
						</p>
						<p>
							Mình xin thưa là: nó đơn giản chỉ là một lớp Java (*.java) chúng ta phải biên dịch thành file class sau đó sẽ chạy bằng file class này, vì thế code sẽ được bảo mật hơn so với cách trên.
						</p>
						<p>
							<span class="right">--- Theo anh <code>tranhuyvc</code> - Administrator của diễn đàn <span class="post-url">congdongjava.com</span> ---</span>
						</p>
					</article>
					<article>
						<h3>Core.java</h3>
						<p>
							Ta tạo một class tên là <code>Core.java</code> thuộc package <code>demo.core</code>. Mục đích của lớp này là kết nối MySQL và thực thi câu lệnh script.<br>
							<img src="/blog/2015/02/07/ket-noi-mysql-bang-servlet-jsp-voi-netbean-phan-2/img/new_class_core.png" alt="New Class Core">
						</p>
						<p>
							Chúng ta sẽ đặt phần cấu hình vào những biến <code>final</code> và gán giá trị trong constructor của lớp. Hàm <code>hasDriver</code> dùng để kiểm tra chúng ta có sử dụng driver hợp lệ hay chưa. Hàm <code>openConnect</code> và <code>closeConnect</code> dùng để mở/đóng kết nối. Hàm <code>getStatement</code> dùng để trả về đối tượng Statement dùng để thực thi các câu SQL theo Singleton Pattern. Hàm <code>executeQuery</code> dùng để thực thi câu SQL có liên quan tới việc truy vấn dữ liệu. Còn <code>executeNonQuery</code> dùng để thực thi các câu SQL liên quan tới việc Insert/Delete/Update dữ liệu.
						</p>
						<p>
							<script src="https://gist.github.com/vhnam/08bdd1b2659537dba674.js"></script>
						</p>
					</article>
					<article>
						<h3>User.java</h3>
						<p>
							Lớp này sẽ là Object sẽ truyền đi giữa các lớp, giống như lớp Data Transfer Object (DTO) trong mô hình 3-Layers.
						</p>
						<p>
							<script src="https://gist.github.com/vhnam/d783075d2f5c2376215f.js"></script>
						</p>
					</article>
					<article>
						<h3>UserHandle.java</h3>
						<p>
							Lớp này sẽ xử lý các thao tác với Database, tương tự lớp Data Access Layer trong mô hình 3-Layers. Hàm <code>getAllUsers</code> trả về toàn bộ user trong bảng user. Hàm <code>insertNew</code> dùng để thêm một user vào database.
						</p>
						<p>
							<script src="https://gist.github.com/vhnam/e28d5e279878161d36f0.js"></script>
						</p>
					</article>
					<article>
						<h3>InsertServlet.java</h3>
						<p>
							Lớp này sử dụng Servlet. Đầu tiên, bạn chuột phải vào <strong>Source Packages</strong> chọn <strong>Servlet</strong>. Điền tên class, package và nhấn <strong>Next</strong>.<br>
							<img src="/blog/2015/02/07/ket-noi-mysql-bang-servlet-jsp-voi-netbean-phan-2/img/insert_servlet_name_location.png" alt="New Insert Servlet - Name and Location">
						</p>
						<p>
							Sau đó, bạn chỉnh sửa lại <strong>Servlet Name</strong> và <strong>URL Pattern(s)</strong> với URL Pattern là đường dẫn tới nơi mà file Servlet này sẽ xử lý. Nhớ đánh dấu check vào ô <strong>Add information to deployment descriptor (web.xml)</strong>.<br>
							<img src="/blog/2015/02/07/ket-noi-mysql-bang-servlet-jsp-voi-netbean-phan-2/img/new_insert_servlet_successfully.png" alt="New Insert Servlet Successfully">
						</p>
						<p>
							Trong file Servlet, mặc định bạn phải override lại 2 hàm <code>doGet</code> và <code>doPost</code>. Ngoài ra, Servlet còn hỗ trợ bạn viết theo chuẩn RESTful gồm các phương thức cơ bản khác như <code>PUT</code>, <code>PATCH</code> và <code>DELETE</code>. Theo luồng xử lý của chúng ta, mục đích chỉ là thêm một user vào database. Do đó, ta chỉ override hàm <code>doPost</code> để đúng ngữ nghĩa theo chuẩn RESTful. Có thể hiểu nó tương tự như Business Logic Layer trong mô hình 3-Layers.
						</p>
						<p>
							<script src="https://gist.github.com/vhnam/a67390017ba550cf7364.js"></script>
						</p>
					</article>
					<article>
						<h3>index.jsp</h3>
						<p>
							Cơ bản thì việc thao tác với giao diện thì Servlet tỏ ra yếu thế. Vì vậy, ta sử dụng JSP để tạo một file HTML và có để viết mã Java bên trong file. Cách này giống như bên PHP vậy. Nhưng cách sử dụng thì có một chút khác biệt.
							<ul>
								<li>
									<code>&lt;! your comment --&gt;</code> để viết comment.
								</li>
								<li>
									<code>&lt;%! your code %&gt;</code> để khai báo biến hoặc phương thức.
								</li>
								<li>
									<code>&lt;%= your code %&gt;</code> để thực thi Expression.
								</li>
							</ul>
						</p>
						<p>
							Để tạo trang JSP, bạn chuột phải vào <strong>Web Pages</strong> -> <strong>New</strong> chọn <strong>JSP</strong>.<br>
							<img src="/blog/2015/02/07/ket-noi-mysql-bang-servlet-jsp-voi-netbean-phan-2/img/new_index_jsp.png" alt="New index.jsp">
						</p>
						<p>
							<script src="https://gist.github.com/vhnam/c6d71c37448d46bf3242.js"></script>
						</p>
					</article>
					<article>
						<h3>Kết quả</h3>
						<p>
							<img src="/blog/2015/02/07/ket-noi-mysql-bang-servlet-jsp-voi-netbean-phan-2/img/get_data_successfully.png" alt="Index">
						</p>
					</article>
					<article>
						<h3>Lưu ý</h3>
						<p>
							Có một vấn đề ở đây, ở bước tạo <strong>InsertServlet.java</strong>, bạn có đặt URL là <span class="post-url">/insert</span>. Nếu bạn chạy theo cấu hình mặc định của Web Server, ở đây mình sử dụng GlassFish 4 thì sẽ không thêm một user vào database được. Do theo cấu hình mặc định, thì nó sẽ là <span class="post-url">/&lt;your project&gt;/insert</span>. Để giải quyết vấn đề này, ta nên chỉnh lại docroot. Chi tiết mời bạn coi tại đây, <a href="http://vhnam.github.io/blog/2015/02/03/huong-dan-thay-doi-docroot-tren-glassfish-4/">Hướng dẫn thay đổi docroot trên GlassFish 4</a>
						</p>
						<p>
							Toàn bộ source code, bạn có thể tham khảo tại đây. <a href="https://github.com/vhnam/DemoJSP">DemoJSP</a>
						</p>
					</article>
					<article>
						<h3>Tham khảo</h3>
						<ul>
							<li>
								<a href="https://thaihoanghai.wordpress.com/2013/04/22/servlet-jsp-example-mysql/">Servlet + JSP + MySQL Example</a>
							</li>
							<li>
								<a href="http://congdongjava.com/forum/threads/t%E1%BB%95ng-quan-v%E1%BB%81-servlet-servlet-in-java-web-application.1720/">Tổng quan về Servlet - Servlet in Java Web Application</a>
							</li>
							<li>
								<a href="http://stackoverflow.com/questions/15799841/access-to-mysql-using-java-servlet-solved">Access to MySQL using Java Servlet? (Solved)</a>
							</li>
							<li>
								<a href="http://nguyenminhan1992.blogspot.com/2014/06/tong-quan-ve-jsp.html">Tổng quan về JSP</a>
							</li>
						</ul>
					</article>
				</div>
				<div class="post-time">
					Last Modified: 12:29 AM - Thursday, February 12, 2015
				</div>
			</section>
		</div>

		<div class="widget">
			<div class="widget-top">
				<span class="glyphicon glyphicon-chevron-up"></span>
			</div>
			<div class="widget-index" title="Mục lục">
				<a href="/index">
					<span class="glyphicon glyphicon-list-alt"></span> Index
				</a>
			</div>
		</div>

		<script src="/public/js/jquery.js"></script>
		<script src="/public/js/script.js"></script>
	</body>
</html>